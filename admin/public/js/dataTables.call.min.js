jQuery(function($) {
	var oTable1 = $('#data_table').DataTable( {
		"processing": true,
		"ordering": false,
		"searching": false,
		"serverSide": true,
		"bAutoWidth": false,
		"language": {
			"lengthMenu": "每页 _MENU_ 条记录",
			"zeroRecords": "没有找到记录",
			"info": "第 _PAGE_ 页 ( 总共 _PAGES_ 页 )",
			"infoEmpty": "无记录",
			"infoFiltered": "(从 _MAX_ 条记录过滤)"
		},
		"columns": [
			{ "data": "name" },
			{ "data": "name_en" },
			{ "data": "country" },
			{ "data": "update_time" },
			{ "data": null },
		],
		"ajax": "<?php echo get_url('/city/citylist');?>",
		"columnDefs": [ {
			"targets": -1,
			"data": "id",
			"render": function ( data, type, full, meta ) {
				var html = '<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">';
				//html += '<a href="<?php echo get_url("/city/detail");?>?id='+data.id+'" class="blue" target="_blank"><i class="icon-zoom-in bigger-130"></i></a>&nbsp;';
				html += '<a href="<?php echo get_url("/city/edit");?>?id=' + data.id + '" class="green"><i class="icon-pencil bigger-130"></i></a>&nbsp;';
				html += '<a href="javascript:;" data-id="' + data.id + '" class="red"><i class="icon-trash bigger-130"></i></a>';
				html += '</div>';
				return html;
			}
		} ]
	});

    //删除列表项的方法
	function deleteData(id){
		if(window.confirm('确定要删除这条记录么？')){
			$.ajax({
			   type: "POST",
			   url: '<?php echo get_url("/city/delete");?>',
			   data: {id:id},
			   dataType: 'json',
			   success: function(data){
				 alert(data.msg);
				 if(data.code > 0){
					//刷新列表
					console.log(oTable1);
					oTable1.draw();
				 }
			   }
			});
		}
	}

    //调用删除的方法
    $(document).on("click", ".action-buttons a", function () {
        if($(this).attr("data-id")) {
            deleteData($(this).attr("data-id"));
        }
    })

});